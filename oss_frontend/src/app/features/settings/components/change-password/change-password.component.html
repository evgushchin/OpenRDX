<div class="change-password-container">
  <div class="form-header">
    <h2>{{ 'settings.changePassword.title' | translate }}</h2>
  </div>


  @if (error) {
    <div class="alert alert-danger">
      {{ error }}
    </div>
  }

  @if (success) {
    <div class="alert alert-success">
      {{ 'settings.changePassword.success' | translate }}
    </div>
  }

  <form [formGroup]="passwordForm"
        (ngSubmit)="onSubmit()"
        class="password-form">
    <div class="form-row">
      <div class="form-group">
        <label for="old_password">{{ 'settings.changePassword.currentPassword' | translate }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showOldPassword ? 'text' : 'password'"
            id="old_password"
            formControlName="old_password"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('old_password')"
          >
          <i
            class="fas"
            [class.fa-eye]="!showOldPassword"
            [class.fa-eye-slash]="showOldPassword"
            (click)="togglePasswordVisibility('old')"
          ></i>
        </div>
        @if (isFieldInvalid('old_password')) {
          <div class="invalid-feedback">
            {{ getErrorMessage('old_password') }}
          </div>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="new_password">{{ 'settings.changePassword.newPassword' | translate }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showNewPassword ? 'text' : 'password'"
            id="new_password"
            formControlName="new_password"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('new_password')"
          >
          <i
            class="fas"
            [class.fa-eye]="!showNewPassword"
            [class.fa-eye-slash]="showNewPassword"
            (click)="togglePasswordVisibility('new')"
          ></i>
        </div>
        @if (isFieldInvalid('new_password')) {
          <div>{{ getErrorMessage('new_password') }}</div>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="confirm_password">{{ 'settings.changePassword.confirmPassword' | translate }}</label>
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirm_password"
            formControlName="confirm_password"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('confirm_password')"
          >
          <i
            class="fas"
            [class.fa-eye]="!showConfirmPassword"
            [class.fa-eye-slash]="showConfirmPassword"
            (click)="togglePasswordVisibility('confirm')"
          ></i>
        </div>
        @if (isFieldInvalid('confirm_password')) {
          <div class="invalid-feedback">
            {{ getErrorMessage('confirm_password') }}
          </div>
        }
      </div>
    </div>

    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="submitting">
        {{ 'common.actions.cancel' | translate }}
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="passwordForm.invalid || submitting">
        @if (submitting) {
          <span class="spinner spinner-sm"></span>
        }
        {{ 'settings.changePassword.submit' | translate }}
      </button>
    </div>
  </form>
</div>
